<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laberinto RPG Visual con Nombres</title>
    <style>
        body {
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: sans-serif;
            color: white;
        }

        #laberinto {
            display: grid;
            grid-template-columns: repeat(20, 30px);
            grid-template-rows: repeat(20, 30px);
            gap: 2px;
            margin-bottom: 15px;
        }

        .celda {
            width: 30px;
            height: 30px;
            background: #0f172a;
        }

        .pared {
            background: #0c1426;
        }

        .jugador {
            background: #007bff;
            border-radius: 5px;
        }

        .meta {
            background: #28a745;
            border-radius: 5px;
        }

        .monstruo {
            background: #ff0000;
            border-radius: 50%;
        }

        #stats {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .barra {
            width: 150px;
            height: 20px;
            background: #222;
            border-radius: 5px;
            overflow: hidden;
        }

        .vida {
            background: #ff4d4d;
            height: 100%;
        }

        .mana {
            background: #4da6ff;
            height: 100%;
        }

        #menuCombate {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        #menuCombate button {
            width: 200px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        #infoCombate {
            margin-top: 10px;
            min-height: 50px;
        }
    </style>
</head>

<body>
    <div id="stats">
        <div>Vida:
            <div class="barra">
                <div id="vidaJugador" class="vida"></div>
            </div>
        </div>
        <div>Mana:
            <div class="barra">
                <div id="manaJugador" class="mana"></div>
            </div>
        </div>
    </div>

    <div id="laberinto"></div>

    <div id="infoCombate"></div>

    <div id="menuCombate">
        <button id="btnAtaque">Ataque B√°sico</button>
        <button id="btnMagia">Magia (-10 Mana)</button>
    </div>

    <script>
        const filas = 20;
        const columnas = 20;
        const laberinto = document.getElementById('laberinto');
        const menuCombate = document.getElementById('menuCombate');
        const infoCombate = document.getElementById('infoCombate');

        let mapa = [];

        let jugador = {
            x: 1,
            y: 1,
            vida: 100,
            ataque: 10,
            magia: 25,
            mana: 50
        };

        let monstruos = [];
        let monstruoActual = null;
        let enCombate = false;

        const nombresMonstruos = ['Johan', 'Gabi', 'Santi', 'Dominic', 'Wasabi'];

        function generarLaberinto(filas, columnas) {
            const grid = Array.from({ length: filas }, () => Array(columnas).fill(1));
            function esValido(f, c) { return f > 0 && f < filas - 1 && c > 0 && c < columnas - 1; }
            function mezclar(arr) { return arr.sort(() => Math.random() - 0.5); }
            function tallar(f, c) {
                grid[f][c] = 0;
                const dirs = mezclar([[1, 0], [-1, 0], [0, 1], [0, -1]]);
                for (const [df, dc] of dirs) {
                    const nf = f + df * 2;
                    const nc = c + dc * 2;
                    if (esValido(nf, nc) && grid[nf][nc] === 1) {
                        grid[f + df][c + dc] = 0;
                        tallar(nf, nc);
                    }
                }
            }
            tallar(1, 1);
            grid[filas - 3][columnas - 3] = 2;
            grid[filas - 3][columnas - 4] = 0;
            grid[filas - 4][columnas - 3] = 0;
            return grid;
        }

        mapa = generarLaberinto(filas, columnas);

        function generarMonstruos() {
            let lista = [];
            for (let i = 0; i < nombresMonstruos.length; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * columnas);
                    y = Math.floor(Math.random() * filas);
                } while (mapa[y][x] !== 0 || (x === 1 && y === 1));
                lista.push({ x, y, vida: 50 + Math.floor(Math.random() * 30), ataque: 5 + Math.floor(Math.random() * 5), nombre: nombresMonstruos[i] });
            }
            return lista;
        }

        monstruos = generarMonstruos();

        function dibujarLaberinto() {
            laberinto.innerHTML = '';
            for (let y = 0; y < mapa.length; y++) {
                for (let x = 0; x < mapa[y].length; x++) {
                    const celda = document.createElement('div');
                    celda.classList.add('celda');
                    if (mapa[y][x] === 1) celda.classList.add('pared');
                    if (mapa[y][x] === 2) celda.classList.add('meta');
                    if (x === jugador.x && y === jugador.y) celda.classList.add('jugador');
                    for (const m of monstruos) {
                        if (m.x === x && m.y === y) celda.classList.add('monstruo');
                    }
                    laberinto.appendChild(celda);
                }
            }
            actualizarStats();
        }

        function actualizarStats() {
            document.getElementById('vidaJugador').style.width = jugador.vida + '%';
            document.getElementById('manaJugador').style.width = jugador.mana + '%';
        }

        function iniciarCombate(monstruo) {
            enCombate = true;
            monstruoActual = monstruo;
            infoCombate.textContent = `¬°Has encontrado a ${monstruo.nombre}! HP: ${monstruo.vida}`;
            menuCombate.style.display = 'flex';
        }

        function ataqueBasico() {
            if (!monstruoActual) return;
            monstruoActual.vida -= jugador.ataque;
            infoCombate.textContent = `Le hiciste ${jugador.ataque} de da√±o a ${monstruoActual.nombre}. HP del monstruo: ${Math.max(monstruoActual.vida, 0)}`;
            if (monstruoActual.vida <= 0) {
                infoCombate.textContent = `üéâ Has derrotado a ${monstruoActual.nombre}!`;
                const index = monstruos.indexOf(monstruoActual);
                if (index > -1) monstruos.splice(index, 1);
                terminarCombate();
                return;
            }
            contraAtaque();
        }

        function usarMagia() {
            if (!monstruoActual) return;
            if (jugador.mana < 10) {
                infoCombate.textContent = 'No tienes suficiente mana';
                return;
            }
            jugador.mana -= 10;
            monstruoActual.vida -= jugador.magia;
            infoCombate.textContent = `Le hiciste ${jugador.magia} de da√±o con magia a ${monstruoActual.nombre}. HP del monstruo: ${Math.max(monstruoActual.vida, 0)}`;
            if (monstruoActual.vida <= 0) {
                infoCombate.textContent = `üéâ Has derrotado a ${monstruoActual.nombre}!`;
                const index = monstruos.indexOf(monstruoActual);
                if (index > -1) monstruos.splice(index, 1);
                terminarCombate();
                return;
            }
            contraAtaque();
        }

        function contraAtaque() {
            jugador.vida -= monstruoActual.ataque;
            infoCombate.textContent += `\n${monstruoActual.nombre} te atac√≥ y te hizo ${monstruoActual.ataque} da√±o. Vida: ${jugador.vida}`;
            if (jugador.vida <= 0) {
                alert('üíÄ Has muerto. Vuelves al inicio');
                jugador.vida = 100;
                jugador.mana = 50;
                jugador.x = 1;
                jugador.y = 1;
                terminarCombate();
            }
            actualizarStats();
        }

        function terminarCombate() {
            enCombate = false;
            monstruoActual = null;
            menuCombate.style.display = 'none';
            infoCombate.textContent = '';
            dibujarLaberinto();
        }

        function moverJugador(dx, dy) {
            if (enCombate) return;
            const nuevoX = jugador.x + dx;
            const nuevoY = jugador.y + dy;
            if (nuevoX < 0 || nuevoY < 0 || nuevoX >= columnas || nuevoY >= filas) return;
            if (mapa[nuevoY][nuevoX] === 1) return;
            jugador.x = nuevoX;
            jugador.y = nuevoY;

            for (const m of monstruos) {
                if (m.x === jugador.x && m.y === jugador.y) {
                    iniciarCombate(m);
                    break;
                }
            }

            if (mapa[nuevoY][nuevoX] === 2) {
                alert('üéâ ¬°Has ganado el laberinto RPG!');
                window.location.href = 'nivel2.html';
            }

            dibujarLaberinto();
        }

        document.getElementById('btnAtaque').addEventListener('click', ataqueBasico);
        document.getElementById('btnMagia').addEventListener('click', usarMagia);

        document.addEventListener('keydown', e => {
            if (enCombate) return;
            if (e.key === 'ArrowUp') moverJugador(0, -1);
            if (e.key === 'ArrowDown') moverJugador(0, 1);
            if (e.key === 'ArrowLeft') moverJugador(-1, 0);
            if (e.key === 'ArrowRight') moverJugador(1, 0);
        });

        dibujarLaberinto();
    </script>
</body>

</html>