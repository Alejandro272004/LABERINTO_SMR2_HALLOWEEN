<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laberinto con Enemigos que Persiguen</title>
    <style>
        body {
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: sans-serif;
            color: white;
        }

        #laberinto {
            display: grid;
            grid-template-columns: repeat(20, 30px);
            grid-template-rows: repeat(20, 30px);
            gap: 2px;
            margin-top: 20px;
        }

        .celda {
            width: 30px;
            height: 30px;
            background: #0f172a;
        }

        .pared {
            background: #0c1426;
        }

        .jugador {
            background: #007bff;
            border-radius: 5px;
        }

        .meta {
            background: #28a745;
            border-radius: 5px;
        }

        .enemigo {
            background: #ff0000;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <h2>üèÉ ¬°Escapa del laberinto!</h2>
    <p>Usa las flechas para moverte. Si un enemigo te alcanza, pierdes.</p>

    <div id="laberinto"></div>

    <script>
        const filas = 20;
        const columnas = 20;
        const laberinto = document.getElementById('laberinto');

        let mapa = [];

        let jugador = { x: 1, y: 1 };
        let enemigos = [];
        let intervaloMovimiento;

        // Generar laberinto aleatorio
        function generarLaberinto(filas, columnas) {
            const grid = Array.from({ length: filas }, () => Array(columnas).fill(1));
            function esValido(f, c) { return f > 0 && f < filas - 1 && c > 0 && c < columnas - 1; }
            function mezclar(arr) { return arr.sort(() => Math.random() - 0.5); }
            function tallar(f, c) {
                grid[f][c] = 0;
                const dirs = mezclar([[1, 0], [-1, 0], [0, 1], [0, -1]]);
                for (const [df, dc] of dirs) {
                    const nf = f + df * 2;
                    const nc = c + dc * 2;
                    if (esValido(nf, nc) && grid[nf][nc] === 1) {
                        grid[f + df][c + dc] = 0;
                        tallar(nf, nc);
                    }
                }
            }
            tallar(1, 1);
            grid[filas - 2][columnas - 2] = 2; // meta
            return grid;
        }

        mapa = generarLaberinto(filas, columnas);

        // Generar enemigos aleatorios
        function generarEnemigos(num) {
            const lista = [];
            for (let i = 0; i < num; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * columnas);
                    y = Math.floor(Math.random() * filas);
                } while (mapa[y][x] !== 0 || (x === 1 && y === 1));
                lista.push({ x, y });
            }
            return lista;
        }

        enemigos = generarEnemigos(5);

        // Dibujar laberinto
        function dibujarLaberinto() {
            laberinto.innerHTML = '';
            for (let y = 0; y < filas; y++) {
                for (let x = 0; x < columnas; x++) {
                    const celda = document.createElement('div');
                    celda.classList.add('celda');
                    if (mapa[y][x] === 1) celda.classList.add('pared');
                    if (mapa[y][x] === 2) celda.classList.add('meta');
                    if (x === jugador.x && y === jugador.y) celda.classList.add('jugador');
                    for (const e of enemigos) {
                        if (e.x === x && e.y === y) celda.classList.add('enemigo');
                    }
                    laberinto.appendChild(celda);
                }
            }
        }

        // Movimiento del jugador
        function moverJugador(dx, dy) {
            const nuevoX = jugador.x + dx;
            const nuevoY = jugador.y + dy;
            if (nuevoX < 0 || nuevoY < 0 || nuevoX >= columnas || nuevoY >= filas) return;
            if (mapa[nuevoY][nuevoX] === 1) return;
            jugador.x = nuevoX;
            jugador.y = nuevoY;

            if (mapa[nuevoY][nuevoX] === 2) {
                alert("üéâ ¬°Has escapado del laberinto!");
                reiniciar();
            }

            verificarColision();
            dibujarLaberinto();
        }

        // Movimiento simple de enemigos hacia el jugador
        function moverEnemigos() {
            for (const e of enemigos) {
                let mejorX = e.x;
                let mejorY = e.y;
                const opciones = [
                    { x: e.x + 1, y: e.y },
                    { x: e.x - 1, y: e.y },
                    { x: e.x, y: e.y + 1 },
                    { x: e.x, y: e.y - 1 },
                ];

                // Elegir movimiento que acerque al jugador
                let menorDist = Infinity;
                for (const o of opciones) {
                    if (o.x >= 0 && o.y >= 0 && o.x < columnas && o.y < filas && mapa[o.y][o.x] !== 1) {
                        const dist = Math.hypot(jugador.x - o.x, jugador.y - o.y);
                        if (dist < menorDist) {
                            menorDist = dist;
                            mejorX = o.x;
                            mejorY = o.y;
                        }
                    }
                }

                e.x = mejorX;
                e.y = mejorY;
            }

            verificarColision();
            dibujarLaberinto();
        }

        // Verificar si alg√∫n enemigo alcanz√≥ al jugador
        function verificarColision() {
            for (const e of enemigos) {
                if (e.x === jugador.x && e.y === jugador.y) {
                    alert("üíÄ ¬°Te atraparon!");
                    reiniciar();
                }
            }
        }

        function reiniciar() {
            jugador = { x: 1, y: 1 };
            enemigos = generarEnemigos(5);
            dibujarLaberinto();
        }

        // Controles
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp') moverJugador(0, -1);
            if (e.key === 'ArrowDown') moverJugador(0, 1);
            if (e.key === 'ArrowLeft') moverJugador(-1, 0);
            if (e.key === 'ArrowRight') moverJugador(1, 0);
        });

        // Bucle de movimiento de enemigos
        intervaloMovimiento = setInterval(moverEnemigos, 600);

        dibujarLaberinto();
    </script>
</body>

</html>