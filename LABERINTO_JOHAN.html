<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laberinto RPG</title>
    <style>
        body {
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: sans-serif;
            color: white;
        }

        #laberinto {
            display: grid;
            grid-template-columns: repeat(20, 30px);
            grid-template-rows: repeat(20, 30px);
            gap: 2px;
            margin-bottom: 15px;
        }

        .celda {
            width: 30px;
            height: 30px;
            background: #0f172a;
        }

        .pared {
            background: #0e162b;
        }

        .jugador {
            background: #007bff;
            border-radius: 5px;
        }

        .meta {
            background: #28a745;
            border-radius: 5px;
        }

        .monstruo {
            background: #ff0000;
            border-radius: 50%;
        }

        #stats {
            display: flex;
            gap: 20px;
        }

        .barra {
            width: 150px;
            height: 20px;
            background: #222;
            border-radius: 5px;
            overflow: hidden;
        }

        .vida {
            background: #ff4d4d;
            height: 100%;
        }

        .mana {
            background: #4da6ff;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="stats">
        <div>Vida:
            <div class="barra">
                <div id="vidaJugador" class="vida"></div>
            </div>
        </div>
        <div>Mana:
            <div class="barra">
                <div id="manaJugador" class="mana"></div>
            </div>
        </div>
    </div>

    <div id="laberinto"></div>

    <script>
        const filas = 20;
        const columnas = 20;
        const laberinto = document.getElementById('laberinto');

        let mapa = [];

        let jugador = {
            x: 1,
            y: 1,
            vida: 100,
            ataque: 10,
            magia: 25,
            mana: 50
        };

        let monstruos = [];

        // ðŸ”¹ Generar laberinto
        function generarLaberinto(filas, columnas) {
            const grid = Array.from({ length: filas }, () => Array(columnas).fill(1));

            function esValido(f, c) {
                return f > 0 && f < filas - 1 && c > 0 && c < columnas - 1;
            }

            function mezclar(arr) {
                return arr.sort(() => Math.random() - 0.5);
            }

            function tallar(f, c) {
                grid[f][c] = 0;
                const dirs = mezclar([[1, 0], [-1, 0], [0, 1], [0, -1]]);
                for (const [df, dc] of dirs) {
                    const nf = f + df * 2;
                    const nc = c + dc * 2;
                    if (esValido(nf, nc) && grid[nf][nc] === 1) {
                        grid[f + df][c + dc] = 0;
                        tallar(nf, nc);
                    }
                }
            }

            tallar(1, 1);

            grid[filas - 3][columnas - 3] = 2; // meta
            grid[filas - 3][columnas - 4] = 0;
            grid[filas - 4][columnas - 3] = 0;

            return grid;
        }

        mapa = generarLaberinto(filas, columnas);

        // ðŸ”¹ Generar monstruos
        function generarMonstruos(cantidad) {
            let lista = [];
            while (lista.length < cantidad) {
                const x = Math.floor(Math.random() * columnas);
                const y = Math.floor(Math.random() * filas);
                if (mapa[y][x] === 0 && !(x === 1 && y === 1)) {
                    lista.push({ x, y, vida: 50 + Math.floor(Math.random() * 30), ataque: 5 + Math.floor(Math.random() * 5) });
                }
            }
            return lista;
        }

        monstruos = generarMonstruos(5);

        // ðŸ”¹ Dibujar laberinto
        function dibujarLaberinto() {
            laberinto.innerHTML = '';
            for (let y = 0; y < mapa.length; y++) {
                for (let x = 0; x < mapa[y].length; x++) {
                    const celda = document.createElement('div');
                    celda.classList.add('celda');
                    if (mapa[y][x] === 1) celda.classList.add('pared');
                    if (mapa[y][x] === 2) celda.classList.add('meta');

                    if (x === jugador.x && y === jugador.y) celda.classList.add('jugador');

                    for (const m of monstruos) {
                        if (m.x === x && m.y === y) celda.classList.add('monstruo');
                    }

                    laberinto.appendChild(celda);
                }
            }

            actualizarStats();
        }

        // ðŸ”¹ Actualizar barras de vida/mana
        function actualizarStats() {
            document.getElementById('vidaJugador').style.width = jugador.vida + '%';
            document.getElementById('manaJugador').style.width = jugador.mana + '%';
        }

        // ðŸ”¹ Combate
        function combate(monstruo) {
            while (jugador.vida > 0 && monstruo.vida > 0) {
                let accion = prompt(`Monstruo HP: ${monstruo.vida}\nTu vida: ${jugador.vida}, Mana: ${jugador.mana}\nElige: "ataque" o "magia"`);

                if (accion === 'ataque') {
                    monstruo.vida -= jugador.ataque;
                    alert(`Le hiciste ${jugador.ataque} daÃ±o`);
                } else if (accion === 'magia' && jugador.mana >= 10) {
                    monstruo.vida -= jugador.magia;
                    jugador.mana -= 10;
                    alert(`Le hiciste ${jugador.magia} daÃ±o con magia`);
                } else {
                    alert('AcciÃ³n invÃ¡lida o mana insuficiente');
                    continue;
                }

                if (monstruo.vida > 0) {
                    jugador.vida -= monstruo.ataque;
                    alert(`El monstruo te atacÃ³ y te hizo ${monstruo.ataque} daÃ±o`);
                    if (jugador.vida <= 0) {
                        alert('ðŸ’€ Has muerto. Vuelves al inicio');
                        jugador.x = 1;
                        jugador.y = 1;
                        jugador.vida = 100;
                        jugador.mana = 50;
                        dibujarLaberinto();
                        return false;
                    }
                } else {
                    alert('ðŸŽ‰ Has derrotado al monstruo!');
                    const index = monstruos.indexOf(monstruo);
                    if (index > -1) monstruos.splice(index, 1);
                    return true;
                }
            }
        }

        // ðŸ”¹ Mover jugador
        function moverJugador(dx, dy) {
            const nuevoX = jugador.x + dx;
            const nuevoY = jugador.y + dy;

            if (nuevoX < 0 || nuevoY < 0 || nuevoX >= columnas || nuevoY >= filas) return;
            if (mapa[nuevoY][nuevoX] === 1) return;

            jugador.x = nuevoX;
            jugador.y = nuevoY;

            // Chequear monstruos
            for (const m of monstruos) {
                if (m.x === jugador.x && m.y === jugador.y) {
                    combate(m);
                    break;
                }
            }

            // Meta
            if (mapa[nuevoY][nuevoX] === 2) {
                alert('ðŸŽ‰ Â¡Has ganado el laberinto RPG!');
                window.location.href = 'nivel2.html';
            }

            dibujarLaberinto();
        }

        // ðŸ”¹ Mover monstruos aleatoriamente
        function moverMonstruos() {
            for (const m of monstruos) {
                const dirs = [[1, 0], [-1, 0], [0, 1], [0, -1]];
                const [dx, dy] = dirs[Math.floor(Math.random() * dirs.length)];
                const nx = m.x + dx;
                const ny = m.y + dy;
                if (nx >= 0 && ny >= 0 && nx < columnas && ny < filas && mapa[ny][nx] === 0) {
                    m.x = nx;
                    m.y = ny;
                }

                if (m.x === jugador.x && m.y === jugador.y) {
                    combate(m);
                }
            }

            dibujarLaberinto();
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp') moverJugador(0, -1);
            if (e.key === 'ArrowDown') moverJugador(0, 1);
            if (e.key === 'ArrowLeft') moverJugador(-1, 0);
            if (e.key === 'ArrowRight') moverJugador(1, 0);
        });

        setInterval(moverMonstruos, 1000);
        dibujarLaberinto();
    </script>
</body>

</html>